<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Demo page</title>

  </head>

  <body>

    <!--START-->
    <div id="contentContainer">

      <style>
        #contentContainer {
          max-width: 700px;
          margin: auto;
          font-family: Helvetica, Arial, sans-serif;
          font-size: 16px;
          line-height: 20px;
        }
        
        /*for toggler buttons */
        .togglebutton {
          border-radius: 5px;
          font-size: 12px;
          font-weight: 400 !important;
          background-color: #eeeeee;
          padding: 3px 10px;
          color: #696969 !important;
          box-shadow: 0 0 7px 2px rgba(0, 0, 0, 0, 07);
          cursor: pointer;
          display: inline-block;
          text-align: center;
          height: 20px !important;
          text-decoration: none;
        }
        
        .togglebutton:hover {
          background-color: #bce3ff;
          text-decoration: none;
        }
        
        .highlight {
          background-color: #275e84 !important;
          color: #ffffff !important;
          font-weight: 600 !important;
        }
        
        .vis {
          width: 100%;
          height: 300px;
          border: 1px solid darkgray;
          margin: 10px 0px;
          margin-bottom: 50px !important;
        }
        
        .drawn {
          border: 0px !important;
        }
        
        .callout {
          border-left: 8px solid lightgray;
          padding: 1px 8px;
          font-size: 14px;
          background-color: #fbfbfb80;
        }
        
        .spacer {
          margin-top: 50px;
        }
        
        .causebutton {
          float: right;
          padding: 3px 35px;
        }
        
        .choice {
          border-bottom: 2px solid #275e8475;
          padding-bottom: 3px;
        }
        
        /* Flexbox layout to align chart and buttons */
        .chart-multiselect-container {
          display: flex;
          justify-content: space-between;
          margin-top: 20px;
        }
        
        #ddc {
          flex-grow: 1; /* Ensure the chart takes up the remaining space */
          width: calc(100% - 220px); /* Account for the width of the button container */
        }
        
        .multiselect-title {
          font-size: 12px;
          margin-bottom: 10px;
          text-align: center;
          display: block;
        }
        
        .multiselect-wrapper {
          width: 150px;
        }
        
        .scrollable-button-container {
          width: 100%;
          height: 325px;
          overflow-y: auto;
          /* border: 1px solid #ddd;
        padding: 10px;
        background-color: #f9f9f9; */
        }
        
        .scrollable-button-container button {
          display: block;
          width: 100%; /* Make each button take up the full width */
          font-size: 10px; /* Smaller text size */
          margin-bottom: 5px;
          padding: 5px;
          background-color: #f3f3f3; /* Default background color */
          border: 0px solid #ccc;
          cursor: pointer;
          text-align: left;
        }
        
        .scrollable-button-container button.selected {
          background-color: #275e84;
          color: white;
        }
        
        .hide {
          display: none;
        }
        
        .vis-parent {
            height: 400px;
        }
        
        .copy-wrapper {
          height: 100px;
        }
        
        .ddc-copy {
          margin-top: 20px; /* Base margin */
          transition: margin-top 0.3s ease; /* Smooth transition */
        }
        
        
            /* SCROLLBAR */
        
            /* width */
            ::-webkit-scrollbar {
              width: 0.20rem;
          }
        
          /* Track */
          ::-webkit-scrollbar-track {
              background: rgb(246, 246, 246);
          }
        
          /* Track on Hover */
          ::-webkit-scrollbar-track:hover {
              background: rgb(240, 240, 240);
          }
        
          /* Handle */
          ::-webkit-scrollbar-thumb {
              background: #97B1C3;
          }
        
          /* Handle on hover */
          ::-webkit-scrollbar-thumb:hover {
            background: #97B1C3;
          }
        
          .sr-only {
            position:absolute;
            left:-10000px;
            top:auto;
            width:1px;
            height:1px;
            overflow:hidden;
            }
      </style>
          <!-- Import vega dependencies that are compatible with IE11-->
          <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
          <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
          <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
          <script src="https://d3js.org/d3.v6.min.js"></script>


      <h1>Provisional Birth and Death Data</h1>
      <p>The NYC Health Department collects data on every birth and death that happens in New York City. These data, called vital statistics, provide a fundamental understanding of birth trends, death trends, and population health in New York City.</p>
      <p>The data on this page are <strong>provisional data</strong>, which means that the numbers may change as the Health Department continues to process the data. Publishing provisional data allows the Health Department to share data faster, before it is finalized. 
      <p>Final data are available in the Annual Summary of <a href="https://www.nyc.gov/site/doh/data/data-sets/vital-statistics-data.page">Vital Statistics</a> and  on<a href="https://a816-health.nyc.gov/hdi/epiquery/">EpiQuery</a>.</p>  
      


      <p>Go to:<br><a href="#birthbydemog">Births by Demographics</a> | <a href="#birthchar">Birth Characteristics</a> | <a href="#carechar">Care Characteristics</a> | <a href="#death-section">Deaths</a> | <a href="#infantmort">Infant Mortality</a>
      </p>


      <h2 class="spacer">Birth Data</h2>
      <p>Data on births come from birth certificates. The three birth sections below include quarterly provisional data on demographics, birth characteristics, and care characteristics.</p>
      <h3 id="birthbydemog">Births by Demographics</h3>

      <div class="choice" aria-hidden="true">
        <a id="" onclick="drawChart('#bbd','Total births','Births',false)" tabindex="0" class="togglebutton byDemog highlight">Total</a>
        <a id="" onclick="drawChart('#bbd','Births by maternal age','Births',true,'Age group')" tabindex="0" class="togglebutton byDemog">Maternal age</a>
        <a id="" onclick="drawChart('#bbd','Births by borough','Births',true,'Residence')" tabindex="0" class="togglebutton byDemog">Borough</a>
        <a id="" onclick="drawChart('#bbd','Births by maternal race/ethnicity','Births',true,'Race/ethnicity')" tabindex="0" class="togglebutton byDemog">Race/ethnicity</a>
      </div>

      <div class="vis-parent" aria-hidden="true">
      <div class="vis drawn" id="bbd"></div>
      </div>

      <div class="copy-wrapper">
        <div id="total-births" class="bbd-copy">
          <h3 class="sr-only">Total births</h3>
          <p>Each quarter, there are about 25,000 births in New York City. They have a slight seasonal pattern.</p>

          <div class="sr-only">
            <div style="min-height:494px" id="datawrapper-vis-dS8sr"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/dS8sr/embed.js" charset="utf-8" data-target="#datawrapper-vis-dS8sr"></script><noscript><img src="https://datawrapper.dwcdn.net/dS8sr/full.png" alt="" /></noscript></div>
          </div>
        </div>

        <div id="births-by-maternal-age" class="bbd-copy">
          <h3 class="sr-only">Births by maternal age</h3>
          <p>These counts (the number of events) of births by maternal age show how many births happened in each age group. Counts should not be used to make comparisons between groups, since the population sizes are not the same. For example, the group with the most births may not have the highest birth rate. Fluctuations in counts do not necessarily show a meaningful trend.</p> 
          <div class="sr-only">
            <div style="min-height:474px" id="datawrapper-vis-4ldCw"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/4ldCw/embed.js" charset="utf-8" data-target="#datawrapper-vis-4ldCw"></script><noscript><img src="https://datawrapper.dwcdn.net/4ldCw/full.png" alt="" /></noscript></div>
          </div>
        </div>

        <div id="births-by-borough" class="bbd-copy">
          <h3 class="sr-only">Births by borough</h3>

          <p>These counts of births by borough show how many births happened for residents of each borough. Counts (the number of events) don't take into account the population size of each group, so don't allow for fair comparisons between groups: the borough with the most births may not have the highest birth rate. Fluctuations in counts do not necessarily indicate a meaningful trend.</p>
          <div class="sr-only">
            <div style="min-height:572px" id="datawrapper-vis-psdoC"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/psdoC/embed.js" charset="utf-8" data-target="#datawrapper-vis-psdoC"></script><noscript><img src="https://datawrapper.dwcdn.net/psdoC/full.png" alt="" /></noscript></div>
          </div>
        </div>

        <div id="births-by-maternal-race/ethnicity" class="bbd-copy">
          <h3 class="sr-only">Births by maternal race/ethnicity</h3>
          <p>These counts of births by maternal race/ethnicity show how many births happened in each racial/ethnic group. Counts (the number of events) don't take into account the population size of each group, so don't allow for fair comparisons between groups: the group with the most births may not have the highest birth rate. Fluctuations in counts do not necessarily indicate a meaningful trend.</p>
          <div class="sr-only">
            <div style="min-height:554px" id="datawrapper-vis-WbY8e"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/WbY8e/embed.js" charset="utf-8" data-target="#datawrapper-vis-WbY8e"></script><noscript><img src="https://datawrapper.dwcdn.net/WbY8e/full.png" alt="" /></noscript></div>
          </div>
        </div>
      </div>


      <h3 class="spacer" id="birthchar">Birth Characteristics</h3>
      <div class="choice" aria-hidden="true">
        <a id="" onclick="drawChart('#bbc','Births by method','Percent of births',true)" tabindex="0" class="togglebutton birthChar highlight">Method</a>
        <a id="" onclick="drawChart('#bbc','Births by term','Percent of births',true,'Term')" tabindex="0" class="togglebutton birthChar">Term</a>
        <a id="" onclick="drawChart('#bbc','Births by birthweight','Percent of births',true,'Birthweight')" tabindex="0" class="togglebutton birthChar">Birth weight</a>
        <a id="" onclick="drawChart('#bbc','Births by coverage','Percent of births',true,'Coverage')" tabindex="0" class="togglebutton birthChar">Coverage</a>
      </div>

      <div class="vis-parent" aria-hidden="true">
      <div class="vis drawn" id="bbc"></div>
      </div>

      <div class="copy-wrapper">
        <div id="births-by-method" class="bbc-copy">
          <h3 class="sr-only">Births by method</h3>
          <p>Usually, about two-thirds of births in NYC are vaginal births. Other methods include cesareans (c-sections) and vaginal birth after cesarean (VBAC), which is when somebody gives birth vaginally after previously giving birth by c-section. 
            <div class="sr-only">
              <div style="min-height:394px" id="datawrapper-vis-EOCAE"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/EOCAE/embed.js" charset="utf-8" data-target="#datawrapper-vis-EOCAE"></script><noscript><img src="https://datawrapper.dwcdn.net/EOCAE/full.png" alt="" /></noscript></div>
            </div>
          </p>
        </div>
  
        <div id="births-by-term" class="bbc-copy">
          <h3 class="sr-only">Births by term</h3>
          <p>About 90% of births in NYC are babies born at term, which is at 37 weeks of gestation or older. Pre-term births are when the baby is less than 37 weeks of gestation. A subset of pre-term births are very pre-term births, which are when the baby is less than 32 weeks of gestation at time of birth. Generally, babies have better outcomes when they are born at term.</p>
          <div class="sr-only">
            <div style="min-height:394px" id="datawrapper-vis-g9O1e"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/g9O1e/embed.js" charset="utf-8" data-target="#datawrapper-vis-g9O1e"></script><noscript><img src="https://datawrapper.dwcdn.net/g9O1e/full.png" alt="" /></noscript></div>
          </div>
        </div>
  
        <div id="births-by-birthweight" class="bbc-copy">
          <h3 class="sr-only">Births by birthweight</h3>
          <p>About 90% of babies born in NYC have a normal birthweight — 2,500 grams and above, which is about 5.5 pounds. Babies are considered low birthweight if they weigh less than 2,500 grams. A subset of low birthweight babies are considered very low birthweight, at less than 1,500 grams, or 3.3 pounds.</p>
          <div class="sr-only">

          </div>
        </div>
  
        <div id="births-by-coverage" class="bbc-copy">
          <h3 class="sr-only">Births by coverage</h3>
          <p>Births are categorized as covered by Medicaid or non-Medicaid. Usually, a little more than half of births are covered by Medicaid.</p>
          <div class="sr-only">
            
          </div>
        </div>
      </div>




      <h3 class="spacer" id="carechar">Care Characteristics</h3>
      <p>These indicators of health and care provided during pregnancy or after birth are key to understanding birth outcomes. Knowing more about predictors of poor birth outcomes that may lead to infant death can help providers and families advocate for their patients.</p>
      <div class="choice" aria-hidden="true">
        <a id="" onclick="drawChart('#bcc','Pre-pregnancy diabetes','Mothers with pre-pregnancy diabetes',false)" tabindex="0" class="togglebutton care highlight">Pre-pregnancy diabetes</a>
        <a id="" onclick="drawChart('#bcc','Pre-pregnancy hypertension','Mothers with pre-pregnancy hypertension',false)" tabindex="0" class="togglebutton care">Pre-pregnancy hypertension</a>
        <a id="" onclick="drawChart('#bcc','Prenatal care in first trimester','Prenatal care started in 1st trimester',false)" tabindex="0" class="togglebutton care">Prenatal care</a>
        <a id="" onclick="drawChart('#bcc','Breastfed infants','Breastfed infants',false)" tabindex="0" class="togglebutton care">Breastfeeding</a>
      </div>

      <div class="vis-parent" aria-hidden="true">
      <div class="vis drawn" id="bcc"></div>
      </div>

      <div class="copy-wrapper">
        <div id="pre-pregnancy-diabetes" class="bcc-copy">
          <h3 class="sr-only">Pre-pregnancy diabetes</h3>
          <p> Usually, over 1% of mothers have pre-pregnancy diabetes, which can be a risk factor for poor birth outcomes.
          </p>
          <div class="sr-only">
            <div style="min-height:394px" id="datawrapper-vis-mX6QU"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/mX6QU/embed.js" charset="utf-8" data-target="#datawrapper-vis-mX6QU"></script><noscript><img src="https://datawrapper.dwcdn.net/mX6QU/full.png" alt="" /></noscript></div>
          </div>
        </div>
    
          <div id="pre-pregnancy-hypertension" class="bcc-copy">
            <h3 class="sr-only">Pre-pregnancy hpyertension</h3>

            <p>Usually, under 3% of mothers have pre-pregnancy hypertension, which can be a risk factor for poor birth outcomes.</p>
            <div class="sr-only">
              <div style="min-height:394px" id="datawrapper-vis-beEoQ"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/beEoQ/embed.js" charset="utf-8" data-target="#datawrapper-vis-beEoQ"></script><noscript><img src="https://datawrapper.dwcdn.net/beEoQ/full.png" alt="" /></noscript></div>
            </div>
          </div>
    
          <div id="prenatal-care-in-first-trimester" class="bcc-copy">
            <h3 class="sr-only">Prenatal care in the first trimester</h3>

            <p>About 70% of mothers receive prenatal care starting in the first trimester. This can be a protective factor against adverse birth outcomes. </p>
            <div class="sr-only">
              <div style="min-height:394px" id="datawrapper-vis-pvVhj"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/pvVhj/embed.js" charset="utf-8" data-target="#datawrapper-vis-pvVhj"></script><noscript><img src="https://datawrapper.dwcdn.net/pvVhj/full.png" alt="" /></noscript></div>
            </div>
          </div>
    
          <div id="breastfed-infants" class="bcc-copy">
            <h3 class="sr-only">Breastfed infants</h3>

            <p>Usually, almost 90% of infants are breastfed in the first few days after birth. This can benefit the health of the person who gave birth and their baby. These numbers only represent breastfeeding that happened during the first few days of birth as collected at the hospital or health care facility.</p>
          </div>
          <div class="sr-only">
            <div style="min-height:394px" id="datawrapper-vis-W9dCn"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/W9dCn/embed.js" charset="utf-8" data-target="#datawrapper-vis-W9dCn"></script><noscript><img src="https://datawrapper.dwcdn.net/W9dCn/full.png" alt="" /></noscript></div>
          </div>
      </div>




      <hr class="spacer">

      <h2 class="spacer">Death Data</h2>
      <p>Data on deaths come from death certificates. The Health Department tracks information about all deaths that occur in New York City, even among people who are not residents of NYC. The two death sections below include quarterly provisional data on infant mortality and deaths among all ages, with details on demographics and causes of death.</p>

      <h3 class="spacer" id="death-section">Deaths</h3>
      <div class="choice" aria-hidden="true">
        <a id="" onclick="drawChart('#ddc','Total deaths','Deaths',false); toggleMultiselect(false)" tabindex="0" class="togglebutton mort highlight">Total</a>
        <a id="" onclick="drawChart('#ddc','Deaths by age','Deaths',true); toggleMultiselect(false)" tabindex="0" class="togglebutton mort">Age group</a>
        <a id="" onclick="drawChart('#ddc','Deaths by sex','Deaths',true); toggleMultiselect(false)" tabindex="0" class="togglebutton mort">Sex</a>
        <a id="" onclick="drawChart('#ddc','Deaths by race/ethnicity','Deaths',true); toggleMultiselect(false)" tabindex="0" class="togglebutton mort">Race/ethnicity</a>
        <a id="" onclick="toggleMultiselect(true)" tabindex="0" class="togglebutton mort causebutton">Cause</a>
      </div>

      <div class="vis-parent" aria-hidden="true">
      <div class="chart-multiselect-container">
        <div class="vis drawn" id="ddc"></div>
        <div class="multiselect-wrapper" id="multiselectWrapper" style="display: none;">
          <div class="scrollable-button-container" id="buttonContainer" ></div>
      </div>
      </div>
    </div>

    <div class="copy-wrapper">
      <div id="total-deaths" class="ddc-copy">
        <h3 class="sr-only">Total deaths</h3>
        <p>Usually, there are about 15,000 deaths in New York City each quarter, with a slight seasonal pattern.</p>
        <div class="sr-only">
          <div style="min-height:286px" id="datawrapper-vis-fNmDg"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/fNmDg/embed.js" charset="utf-8" data-target="#datawrapper-vis-fNmDg"></script><noscript><img src="https://datawrapper.dwcdn.net/fNmDg/full.png" alt="" /></noscript></div>
        </div>
      </div>

      <div id="deaths-by-age" class="ddc-copy">
        <h3 class="sr-only">Deaths by age</h3>

        <p>Counts (the number of events) don't take into account the population size of each group, so don't allow for fair comparisons between groups: the group with the most deaths may not have the highest death rate. Fluctuations in counts do not necessarily indicate a meaningful trend.</p>
        <div class="sr-only">
          <div style="min-height:382px" id="datawrapper-vis-HwHyB"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/HwHyB/embed.js" charset="utf-8" data-target="#datawrapper-vis-HwHyB"></script><noscript><img src="https://datawrapper.dwcdn.net/HwHyB/full.png" alt="" /></noscript></div>
        </div>
      </div>

      <div id="deaths-by-sex" class="ddc-copy">
        <h3 class="sr-only">Deaths by sex</h3>

        <p>Counts (the number of events) don't take into account the population size of each group, so don't allow for fair comparisons between groups: the group with the most deaths may not have the highest death rate. Fluctuations in counts do not necessarily indicate a meaningful trend. </p>
        <div class="sr-only">
          <div style="min-height:286px" id="datawrapper-vis-9zBNA"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/9zBNA/embed.js" charset="utf-8" data-target="#datawrapper-vis-9zBNA"></script><noscript><img src="https://datawrapper.dwcdn.net/9zBNA/full.png" alt="" /></noscript></div>
        </div>
      </div>

      <div id="deaths-by-race/ethnicity" class="ddc-copy">
        <h3 class="sr-only">Deaths by race/ethnicity</h3>

        <p>Counts (the number of events) don't take into account the population size of each group, so don't allow for fair comparisons between groups: the group with the most deaths may not have the highest death rate. Fluctuations in counts do not necessarily indicate a meaningful trend. </p>
        <div class="sr-only">
          <div style="min-height:382px" id="datawrapper-vis-tbeue"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/tbeue/embed.js" charset="utf-8" data-target="#datawrapper-vis-tbeue"></script><noscript><img src="https://datawrapper.dwcdn.net/tbeue/full.png" alt="" /></noscript></div>
        </div>
      </div>

      <div id="deaths-by-cause" class="ddc-copy">
        <h3 class="sr-only">Deaths by cause</h3>

        <p>Selected causes of death are shown above, including both leading causes of death as well as causes that are priorities for the Health Department.</p>
        <div class="sr-only">
          <div style="min-height:418px" id="datawrapper-vis-D4eSj"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/D4eSj/embed.js" charset="utf-8" data-target="#datawrapper-vis-D4eSj"></script><noscript><img src="https://datawrapper.dwcdn.net/D4eSj/full.png" alt="" /></noscript></div>
        </div>
      </div>
    </div>

    <h3 id="infantmort">Infant Mortality Rates</h3>
    <div class="choice" aria-hidden="true">
      <a id="" onclick="drawChart('#dim','Total IMR','Infant mortality rate',false)" tabindex="0" class="togglebutton infantMort highlight">Overall</a>
      <a id="" onclick="drawChart('#dim','IMR by age','Infant mortality rate',true,'Age')" tabindex="0" class="togglebutton infantMort">Age</a>
      <a id="" onclick="drawChart('#dim','IMR by borough','Infant mortality rate',true,'Residence')" tabindex="0" class="togglebutton infantMort">Borough</a>
      <a id="" onclick="drawChart('#dim','IMR by race/ethnicity','Infant mortality rate',true,'Race/ethnicity')" tabindex="0" class="togglebutton infantMort">Race/ethnicity</a>
    </div>

    <div class="vis-parent" aria-hidden="true">
    <div class="vis drawn" id="dim"></div>
    </div>

    <div class="copy-wrapper">
      <div id="total-imr" class="dim-copy">
        <h3 class="sr-only">Infant mortality</h3>

        <p>Infant mortality rates are the number of infant deaths (less than 1 year of age) per 1,000 live births. Due to the small number of infant deaths, rates can fluctuate. All infant mortality data are shown as four-quarter rolling averages, meaning one quarter's data is averaged with the data from the three previous quarters.</p>
        <p><a href="https://www.nyc.gov/site/doh/about/about-doh/healthynyc.page">Data on maternal mortality are available at HealthyNYC</a></p>
        <div class="sr-only">
          <div style="min-height:394px" id="datawrapper-vis-XOgEG"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/XOgEG/embed.js" charset="utf-8" data-target="#datawrapper-vis-XOgEG"></script><noscript><img src="https://datawrapper.dwcdn.net/XOgEG/full.png" alt="" /></noscript></div>
        </div>
      </div>

      <div id="imr-by-age" class="dim-copy">
        <h3 class="sr-only">Infant mortality by age</h3>

        <p>There is usually a higher neonatal infant mortality rate — deaths among infants less than 28 days old. Deaths are post-neonatal if the baby is at least 28 days old but less than 1 year old. Due to the small number of infant deaths, rates can fluctuate. All infant mortality data are shown as four-quarter rolling averages, meaning one quarter's data is averaged with the data from the three previous quarters.</p>
        <div class="sr-only">
          <div style="min-height:394px" id="datawrapper-vis-bTK6E"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/bTK6E/embed.js" charset="utf-8" data-target="#datawrapper-vis-bTK6E"></script><noscript><img src="https://datawrapper.dwcdn.net/bTK6E/full.png" alt="" /></noscript></div>
        </div>
      </div>

      <div id="imr-by-boro" class="dim-copy">
        <h3 class="sr-only">Infant mortality by borough</h3>

        <p>Due to the small number of infant deaths, rates can fluctuate. All infant mortality data are shown as four-quarter rolling averages, meaning one quarter's data is averaged with the data from the three previous quarters.</p>
        <div class="sr-only">
          <div style="min-height:572px" id="datawrapper-vis-74W3P"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/74W3P/embed.js" charset="utf-8" data-target="#datawrapper-vis-74W3P"></script><noscript><img src="https://datawrapper.dwcdn.net/74W3P/full.png" alt="" /></noscript></div>
        </div>
      </div>

      <div id="imr-by-race/ethnicity" class="dim-copy">
        <h3 class="sr-only">Infant mortality by race/ethnicity</h3>

        <p>Due to the small number of infant deaths, rates can fluctuate. All infant mortality data are shown as four-quarter rolling averages, meaning one quarter's data is averaged with the data from the three previous quarters.</p>
        <div class="sr-only">
          <div style="min-height:474px" id="datawrapper-vis-KLKeC"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/KLKeC/embed.js" charset="utf-8" data-target="#datawrapper-vis-KLKeC"></script><noscript><img src="https://datawrapper.dwcdn.net/KLKeC/full.png" alt="" /></noscript></div>
        </div>
      </div>
    </div>




      <hr>

      <h2 class="spacer">Additional Resources</h2>
        
      <p>Download these data at our <a href="https://www.github.com/nychealth/provisional-births-and-deaths">Github repository</a>:
        <ul>
          <li><a href="https://github.com/nychealth/provisional-vital-statistics/blob/main/data.csv">Data</a></li>
          <li><a href="https://github.com/nychealth/provisional-vital-statistics/tree/main/data-tables">Tables</a></li>
          <li><a href="https://github.com/nychealth/provisional-vital-statistics">Documentation and notes</a></li>
        </ul>
        </p>


      <p>Explore finalized birth and death data on <a href="https://a816-health.nyc.gov/hdi/epiquery/">Epiquery</a>:
        <ul>
          <li><a href="https://a816-health.nyc.gov/hdi/epiquery/visualizations?PageType=ps&PopulationSource=Birth">Births</a></li>
          <li><a href="https://a816-health.nyc.gov/hdi/epiquery/visualizations?PageType=ps&PopulationSource=IMR">Infant mortality</a></li>
          <li><a href="https://a816-health.nyc.gov/hdi/epiquery/visualizations?PageType=ps&PopulationSource=Death">Deaths</a></li>
        </ul>
      </p>
      
      <h2 class="spacer">More Information</h2>
      <ul>
        <li>Vital Statistics Offerings</li>
        <li><a href="https://www.nyc.gov/site/doh/data/data-sets/vital-statistics-data-archive.page">and Death Historical Data</a></li>
        <li><a href="https://www.nyc.gov/site/doh/data/data-sets/cause-of-death-quality.page">Cause of Death Quality</a></li>
        <li><a href="https://www.nyc.gov/site/doh/data/data-sets/training-and-resources.page">Trainings and resources</a></li>
        <li><a href="https://www.nyc.gov/site/doh/about/about-doh/healthynyc.page">HealthyNYC: New York City's Campaign for Healtheir, Longer Lives</a>
          <ul>
            <li><strong>Note:</strong> Recent years of data reported for HealthyNYC are provisional in nature, but they will not exactly match death counts presented here. HealthyNYC data are specific to NYC residents who died in NYC, as opposed to the data presented here, which is based on occurrences in NYC regardless of resident status.</li>
          </ul>
        </li>

      </ul>
     </p>

    </div>


    <script>
      // DETECT IF SUBMETRIC STARTS WITH NUMERIC VALUE
function isNonNumeric(value) {
  return isNaN(parseInt(value.charAt(0)));
}

// DYNAMICALLY SORT SUBMETRICS FOR LEGEND
function sortSubmetrics(data) {
  const submetrics = Array.from(new Set(data.map(d => d.submetric))); 

  const nonNumeric = submetrics.filter(isNonNumeric);
  const numeric = submetrics.filter(d => !isNonNumeric(d));

  // nonNumeric.sort();
  numeric.sort((a, b) => a.localeCompare(b, undefined, { numeric: true }));

  // RETURN COMBINED SORTED ARRAY WITH NON NUMERIC VALUES FIRST
  return [...nonNumeric, ...numeric];
}

// Declare data source
let dataSource = 'https://gist.githubusercontent.com/mmontesanonyc/2dde434881f7fcd95799d7da7b3d9d4b/raw/9a6657a8a6815843d44123a0fb66f29697d35c7a/data.csv'

// MAIN CHART-DRAWING FUNCTION
async function drawChart(destination, metric, label, multi, schemaFlag = "default", selectedCauses = []) {
  
  /*  Arguments passed into drawChart function:
            - destination: the ID of the vis container
            - metric is a string that filters the data: eg, 'Total births' or 'By maternal age'
            - label is a string that determines the chart's subtitle/y-axis label
            - multi is a true/false: false sets fill, true inserts the 'color' mark property on encoding
            - schemaFlag (optional) is a string that determines which schema to use. Defaults to "default".

            - selectedCauses: array of selected causes for dynamic filtering.
 */

  // INITIALIZE VARIABLES
  let fillColor = multi === false ? "#f3f3f3" : "#f3f3f300";
  let subSeries = multi === false ? "" : "submetric";
  let fillLayer = multi === false ? [{"mark": {"type": "area", "color": "#f0f8ff85", "tooltip": false}}] : [];
  let legend = multi === true ? {"columns": 6, "labelFontSize": 10, "symbolSize": 80} : {"disable": true};

  // CREATE ARRAY OF SUBMETRICS TO PASS INTO SPEC.ENCODING.COLOR.SCALE.DOMAIN
  let groups = [];

  let data;
  await fetch('https://gist.githubusercontent.com/mmontesanonyc/2dde434881f7fcd95799d7da7b3d9d4b/raw/9a6657a8a6815843d44123a0fb66f29697d35c7a/data.csv')
    .then(response => response.text())
    .then(csvText => {
      data = d3.csvParse(csvText).filter(d => d.metric === metric);
    });

  const sortedSubmetrics = sortSubmetrics(data);

  // COMMON ELEMENTS OF SCHEMA
var partialConfig = {
    "range": {
      "category": [
        "#003F5C",
        "#FF8440",
        "#7A4694",
        "#FFA600",
        "#EF5E4B",
        "#BD4B86",
        "#425280"
            ]
  },
  "view": {"stroke": null},
  "axisX": {
    "labelAngle": 0,
    "grid": false,
    "tickSize": {
      "condition": {
        "test": {"field": "value", "timeUnit": "quarter", "equal": 1},
        "value": 15
      },
      "value": 9
    },
    "tickWidth": {
      "condition": {
        "test": {"field": "value", "timeUnit": "quarter", "equal": 1},
        "value": 1.25
      },
      "value": 0.5
    },
    "labelExpr": "[quarter(datum.value) === 1 ? timeFormat(datum.value, '%Y') + ' Q' + quarter(datum.value) : 'Q' + quarter(datum.value)]"
  },
  "axisY": {
    "domain": false,
    "ticks": false,
    "tickCount": 3, 
    "orient": "left",
    "zindex": 0, 
    "gridDash": [2]
   }
  }

  const colorRange = partialConfig.range.category;

  let color;
  if (metric === "Deaths by cause") {
    color = {
      "condition": {
        "param": "hover",
        "field": "submetric",
        "type": "nominal",
        "legend": {
          "orient": "bottom", 
          "title": null, 
          "labelLimit": 1000,
          "values": selectedCauses  // Filter the legend to only show selected causes for this chart
        },
        "scale": {
          "domain": selectedCauses.length > 0 ? selectedCauses : sortedSubmetrics,  // Use selected causes if any, otherwise default
          "range": colorRange  
        }
      },
      "value": "gray"
    }
  } else {
    // Default color scale for other charts
    color = multi === true ? {
      "condition": {
        "param": "hover",
        "field": "submetric",
        "type": "nominal",
        "legend": {
          "orient": "bottom", 
          "title": null, 
          "labelLimit": 1000
        },
        "scale": {
          "domain": sortedSubmetrics,  
          "range": colorRange  
        }
      },
      "value": "gray"
    } : {}
  }

  var title = {
    "text": label,
    "subtitlePadding": 10,
    "fontWeight": "normal",
    "anchor": "start",
    "fontSize": 12,
    "font": "sans-serif",
    "baseline": "top",
    "dy": -10,
    "subtitleFontSize": 13
  }

  var tooltipContent = [
    { "title": "Quarter", "field": "date", "timeUnit": "quarteryear" },
    { "title": `${label}`, "field": "valueWithDisplay" },
    { "title": "Group", "field": "submetric"}
  ]

  var encoding = {
    "x": {
      "timeUnit": "quarteryear",
      "field": "date",
      "title": "",
      "axis": {"zindex": 1},
      "scale": {"padding": 30}
    },
    "y": {
      "field": "value",
      "type": "quantitative",
      "title": ""
    },
    "color": color,
    "opacity": {"condition": {"param": "hover", "value": 1}, "value": 0.35}
  }

  // DEFAULT: HOVER SCHEMA
  var spec1 = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "description": "",
    "height": 250,
    "width": "container",
    "title": title,
    "config": {
      ...partialConfig,
      "legend": legend
    },
    "data": {
      "url": dataSource
    },
    "transform": [
      { "filter": `datum.metric === '${metric}'` },

      {
        "calculate": "datum.display === 'Percent' ? '%' : (datum.display === 'Number' ? '' : datum.display)",
        "as": "formattedDisplay"
      },
      {
        "calculate": "format(datum.value, ',') + ' ' + datum.formattedDisplay",
        "as": "valueWithDisplay"
      }
    ],
    "encoding": encoding,
    "layer": [
      ...fillLayer,
      {
        "description": "Transparent layer to trigger hover more easily",
        "params": [
          {
            "name": "hover",
            "select": {
              "type": "point",
              "fields": ["submetric"],
              "on": "pointerover"
            }
          }
        ],
        "mark": {"type": "line", "stroke": "transparent", "strokeWidth": 15}
      },
      {
        "mark": {"type": "line", "point": {"size": 70}},
        "encoding": {
          "tooltip": tooltipContent
        }
      },
      {
        "transform": [
          {
            "aggregate": [
              {"op": "argmin", "field": "date", "as": "value"},
              {"op": "min", "field": "date", "as": "date"}
            ],
            "groupby": ["submetric"]
          },
          { "filter": "datum.value !== null && datum.value !== '' && datum.value !== 'null'" }
        ],
        "encoding": {
          "x": {"field": "date"},
          "y": {"field": "value['value']"},
          "text": {
            "condition": {"param": "hover", "field": "submetric", "empty": false},
            "value": ""
          },
          "color": {"field": "submetric", "type": "nominal"}
        },
        "mark": {"type": "text", "align": "left", "dx": -8, "dy": -15,"fontSize": 12, "fontWeight": "bold"}
      }
    ]
  }

  // AlT SCHEMA - FOR MULTISELECT DEATH CAUSES CHART
  const spec2 = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "description": "",
    "height": 250,
    "width": "container",
    "title": title,
    "config": {
      ...partialConfig,
      "legend": {"columns": 4, "labelFontSize": 10, "symbolSize": 80}
    },
    "data": {
      "url": dataSource
    },
    "transform": [
      {
        "filter": {
          "field": "metric",
          "equal": "Deaths by cause"
        }
      },
      {
        "filter": {
          "field": "submetric",
          "oneOf": selectedCauses
        }
      },
      { "filter": "datum.value !== null && datum.value !== '' && datum.value !== 'null'" },
      {
        "calculate": "datum.display === 'Percent' ? ' %' : (datum.display === 'Number' ? '' : datum.display)",
        "as": "formattedDisplay"
      },
      {
        "calculate": "format(datum.value, ',') + ' ' + datum.formattedDisplay",
        "as": "valueWithDisplay"
      }
    ],  
    "encoding": encoding,
    "layer": [
      {
        "description": "Transparent layer to trigger hover more easily",
        "params": [
          {
            "name": "hover",
            "select": {
              "type": "point",
              "fields": ["submetric"],
              "on": "pointerover"
            }
          }
        ],
        "mark": {"type": "line", "stroke": "transparent", "strokeWidth": 15}
      },
      {
        "mark": {"type": "line", "point": {"size": 70}},
        "encoding": {
          "tooltip": tooltipContent
        }
      },
      {
        "transform": [
          {
            "aggregate": [
              {"op": "argmin", "field": "date", "as": "value"},
              {"op": "min", "field": "date", "as": "date"}
            ],
            "groupby": ["submetric"]
          },
        ],
        "encoding": {
          "x": {"field": "date"},
          "y": {"field": "value['value']"},
          "text": {
            "condition": {"param": "hover", "field": "submetric", "empty": false},
            "value": ""
          },
          "color": {"field": "submetric", "type": "nominal"}
        },
        "mark": {"type": "text", "align": "left", "dx": -8, "dy": -15,"fontSize": 12, "fontWeight": "bold"}
      }
    ]
  }

  const chosenSpec = schemaFlag === "alternative" ? spec2 : spec1;

  try {
    // RUN VEGA EMBED
    await vegaEmbed(destination, chosenSpec, {actions: false });
  } catch (error) {
    console.log('Error embedding chart:', error);
  }


  /* ACTIONS ALTERNATIVES
  {
      actions: {
        export: { png: true, svg: true },
        source: false,  
        compiled: false, 
        editor: true 
      }
    }
  */

  // Show/hide content for each section based on button click
  let copyHolders = "." + (destination + '-copy').slice(1)     // copy holders all have a class of ${destination}-copy
  let viewCopy = metric.toLowerCase().replace(/\s+/g, '-');    // copy holders all have an id of {$metric} (lower case, with - instead of space)
  let viewCopyHolders = document.querySelectorAll(copyHolders) // get all copy holders for this chart section
  viewCopyHolders.forEach(child => child.classList.add('hide')) // hide all of them
  document.getElementById(viewCopy).classList.remove('hide')   // show the one selected

}

// CREATE CHART CONFIGS
const chartConfigs = [
  { destination: '#bbd', metric: 'Total births', label: 'Births',  multi: false, tooltip: "", schemaFlag: "default" },
  { destination: '#bbc', metric: 'Births by method', label: 'Percent of births', multi: true, tooltip: "", schemaFlag: "default" },
  { destination: '#bcc', metric: 'Pre-pregnancy diabetes', label: 'Mothers with pre-pregnancy diabetes', multi: false, tooltip: "", schemaFlag: "default" },
  { destination: '#dim', metric: 'Total IMR', label: 'Infant mortality rate', multi: false, tooltip: "", schemaFlag: "default" },
  { destination: '#ddc', metric: 'Total deaths', label: 'Deaths', multi: false, tooltip: "", schemaFlag: "default"  },
];

// INITIALIZE CHART DRAWS
chartConfigs.forEach(({ destination, metric, label, multi, schemaFlag }) => {
  drawChart(destination, metric, label, multi, schemaFlag);
});

// FUNCTIONALISED EVENT LISTENER 
function addClickListeners(elements) {
  elements.forEach((element) => {
    element.addEventListener('click', function() {
      elements.forEach(el => el.classList.remove('highlight'));
      this.classList.add('highlight');
    });
  });
}
// EVENT LISTENERS FOR EACH CHART SECTION
addClickListeners(document.querySelectorAll('.byDemog'));
addClickListeners(document.querySelectorAll('.birthChar'));
addClickListeners(document.querySelectorAll('.care'));
addClickListeners(document.querySelectorAll('.infantMort'));
addClickListeners(document.querySelectorAll('.mort'));

// TOGGLE THE VISIBILITY OF THE MULTISELECT CONTAINER
function toggleMultiselect(show) {
  const multiselectWrapper = document.getElementById('multiselectWrapper');
  
  if (show) {
    multiselectWrapper.style.display = 'block'; // Show both title and buttons
    generateButtons(); // Populate the multiselect
  } else {
    multiselectWrapper.style.display = 'none'; // Hide the multiselect container
  }
}

// GENERATE DEATH BY CAUSE BUTTONS
function generateButtons() {
  fetch(dataSource)
    .then(response => response.text())
    .then(csvText => {
      const parsedData = d3.csvParse(csvText);
      const deathsByCauseData = parsedData.filter(d => d.metric === "Deaths by cause");
      
      // Calculate total value for each cause
      const causeTotals = {};
      deathsByCauseData.forEach(d => {
        if (!causeTotals[d.submetric]) {
          causeTotals[d.submetric] = 0;
        }
        causeTotals[d.submetric] += +d.value; 
      });

      // Sort the causes by their total values and get the top 3
      const topCauses = Object.keys(causeTotals)
        .sort((a, b) => causeTotals[b] - causeTotals[a]) 
        .slice(0, 3); // Take the top 3

      const uniqueCauses = [...new Set(deathsByCauseData.map(d => d.submetric))];
      const buttonContainer = document.getElementById('buttonContainer');
      
      buttonContainer.innerHTML = ""; 

      uniqueCauses.forEach((cause) => {
        const button = document.createElement('button');
        button.textContent = cause;
        button.setAttribute('data-cause', cause); 
        button.classList.add('cause-button'); 

        if (topCauses.includes(cause)) {
          button.classList.add('selected');
        }

        button.addEventListener('click', function () {
          this.classList.toggle('selected');
          updateChart();
        });

        buttonContainer.appendChild(button);
      });

      updateChart();
    });
}

// GET SELECTED CAUSES FROM BUTTONS
function getSelectedCauses() {
  const selectedButtons = document.querySelectorAll('.cause-button.selected');
  return Array.from(selectedButtons).map(button => button.getAttribute('data-cause'));
}

// DYNAMICALLY ADJUST MARGIN WHEN ALL CAUSES ARE CHOSEN
function adjustMarginBasedOnCauses() {
  const selectedCauses = getSelectedCauses(); 
  const baseMargin = 20; 
  const additionalMargin = selectedCauses.length * 5;
  const totalMargin = baseMargin + additionalMargin;
  
  document.querySelector('.ddc-copy').style.marginTop = `${totalMargin}px`;
}


// UPDATE CHART BASED ON SELECTED BUTTONS
function updateChart() {
  const selectedCauses = getSelectedCauses();

  drawChart('#ddc', 'Deaths by cause', 'Deaths', true, 'alternative', selectedCauses);
  adjustMarginBasedOnCauses(); // Adjust margin based on selection

  // document.getElementById('deaths-by-cause').classList.remove('hide')
}

    </script>

    <!--END-->
  </body>
</html>
